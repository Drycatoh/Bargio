$(document).ready(function(){function t(t,i){var o=[],r,u,e,f;if(t.length===0){n.data.datasets[0].data=[];n.update();return}for(r=moment(t[0][0]).add(1,i),i==="days"&&r.set("hour",0),r.set("minute",0),u=0,e=0;e<t.length;e++)f=t[e],moment(f[0]).isAfter(r)?(o.push({x:moment(r).subtract(1,i),y:-u}),r=moment(f[0]).add(1,i),i==="days"&&r.set("hour",0),r.set("minute",0),u=f[2]):u+=f[2];o.push({x:moment(r).subtract(1,i),y:-u});n.data.datasets[0].data=o;n.update()}function i(n){for(var i=0,t=0;t<n.length;t++)n[t][2]<0&&(i-=n[t][2]);$("#montant-total").text(i.toFixed(2).replace(".",","))}function r(){if($("#radio-conso-soiree").is(":checked"))$("#choix-date").show(),$("#timepicker-conso").datetimepicker("destroy"),$("#timepicker-conso").datetimepicker({format:"DD/MMM/YYYY",viewMode:"days"});else if($("#radio-conso-mois").is(":checked"))$("#choix-date").show(),$("#timepicker-conso").datetimepicker("destroy"),$("#timepicker-conso").datetimepicker({format:"MM/YYYY",viewMode:"months"});else if($("#radio-conso-annee").is(":checked"))$("#choix-date").show(),$("#timepicker-conso").datetimepicker("destroy"),$("#timepicker-conso").datetimepicker({format:"YYYY",viewMode:"years"});else if($("#radio-conso-tout").is(":checked")){$("#choix-date").hide();$("#timepicker-conso").datetimepicker("destroy");var n=$(".table-consos-total-datatable").DataTable();n.clear();n.rows.add(transactions);n.draw();t(transactions,"month");i(transactions)}}var n=null;(()=>{var i=$(".table-consos-total-datatable").DataTable({scrollX:!0,language:{info:"_TOTAL_ bucquages au total",paginate:{previous:"<",next:">"},sLengthMenu:"_MENU_ transactions par page",sSearch:"Rechercher"},columnDefs:[{targets:0,render:$.fn.dataTable.render.moment("DD/MM/YYYY HH:mm")}]}),t;i.clear();$("#choix-date").hide();t=document.getElementById("conso-chart");moment.locale("fr");n=new Chart(t,{type:"line",data:{datasets:[{data:[],borderColor:"forestgreen",fill:"origin"}]},options:{scales:{xAxes:[{type:"time",time:{displayFormats:{millisecond:"DD/MM/YYYY HH:mm",second:"HH:mm",minute:"HH:mm",hour:"HH:mm",day:"DD/MM",week:"DD/MM",month:"MM/YYYY",quarter:"MM/YYYY",year:"MM/YYYY"}}}],yAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:"Broüsoüfs dépensés (€)"}}]},elements:{line:{tension:0}},legend:{display:!1}}})})();(()=>{transactions=$.map(transactions,function(n){return[[moment(n.date,"DD/MM/YYYY HH:mm").toDate(),n.commentaire,n.montant]]});var n=$(".table-consos-total-datatable").DataTable();n.clear();n.rows.add(transactions);n.draw()})();(()=>{$("#timepicker-conso").on("change.datetimepicker",function(){var e=$("#timepicker-conso").datetimepicker("viewDate"),n="years",r,u,f;$("#radio-conso-mois").is(":checked")?n="months":$("#radio-conso-soiree").is(":checked")&&(n="days",e.set("hour",15));r=$.grep(transactions,function(t){return e.isBefore(t[0])&&moment(e).add(1,n).isAfter(t[0])});u=$(".table-consos-total-datatable").DataTable();u.clear();u.rows.add(r);u.draw();f="month";n==="months"?f="day":n==="days"&&(f="hour");t(r,f);i(r)});$("input:radio").change(r);r()})()});