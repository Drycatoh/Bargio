$(document).ready(function(){function t(t,i){var r,u;const f=[];if(t.length===0){n.data.datasets[0].data=[];n.update();return}r=moment(t[0][0]).add(1,i);i==="days"&&r.set("hour",0);r.set("minute",0);u=0;for(let n=0;n<t.length;n++){const e=t[n];e[2]<0&&(moment(e[0]).isAfter(r)?(f.push({x:moment(r).subtract(1,i),y:-u}),r=moment(e[0]).add(1,i),i==="days"&&r.set("hour",0),r.set("minute",0),u=e[2]):u+=e[2])}f.push({x:moment(r).subtract(1,i),y:-u});n.data.datasets[0].data=f;n.update()}function i(n){var t=0;for(let i=0;i<n.length;i++)n[i][2]<0&&(t-=n[i][2]);$("#montant-total").text(t.toFixed(2).replace(".",","))}function r(){var n=null;if($("#radio-conso-soiree").is(":checked"))$("#choix-date").show(),n=moment($("#Entry_EntryDate").val(),"YYYY-MM-DD hh:mm a").toDate(),$("#timepicker-conso").datetimepicker("destroy"),$("#timepicker-conso").datetimepicker({format:"DD/MMM/YYYY",viewMode:"days",date:n});else if($("#radio-conso-mois").is(":checked"))$("#choix-date").show(),n=moment($("#Entry_EntryDate").val(),"YYYY-MM-DD hh:mm a").toDate(),$("#timepicker-conso").datetimepicker("destroy"),$("#timepicker-conso").datetimepicker({format:"MM/YYYY",viewMode:"months",date:n});else if($("#radio-conso-annee").is(":checked"))$("#choix-date").show(),n=moment($("#Entry_EntryDate").val(),"YYYY-MM-DD hh:mm a").toDate(),$("#timepicker-conso").datetimepicker("destroy"),$("#timepicker-conso").datetimepicker({format:"YYYY",viewMode:"years",date:n});else if($("#radio-conso-tout").is(":checked")){$("#choix-date").hide();$("#timepicker-conso").datetimepicker("destroy");n=moment($("#Entry_EntryDate").val(),"YYYY-MM-DD hh:mm a").toDate();const r=$(".table-consos-total-datatable").DataTable();r.clear();r.rows.add(transactions);r.draw();t(transactions,"month");i(transactions)}}var n=null;(()=>{var i=$(".table-consos-total-datatable").DataTable({scrollX:!0,language:{info:"_TOTAL_ bucquages au total",paginate:{previous:"<",next:">"},sLengthMenu:"_MENU_ transactions par page",sSearch:"Rechercher"},columnDefs:[{targets:0,render:$.fn.dataTable.render.moment("DD/MM/YYYY HH:mm")}]}),t;i.clear();$("#choix-date").hide();t=document.getElementById("conso-chart");moment.locale("fr");n=new Chart(t,{type:"line",data:{datasets:[{data:[],borderColor:"forestgreen",fill:"origin"}]},options:{scales:{xAxes:[{type:"time",time:{displayFormats:{millisecond:"DD/MM/YYYY HH:mm",second:"HH:mm",minute:"HH:mm",hour:"HH:mm",day:"DD/MM",week:"DD/MM",month:"MM/YYYY",quarter:"MM/YYYY",year:"MM/YYYY"}}}],yAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:"Broüsoüfs dépensés (€)"}}]},elements:{line:{tension:0}},legend:{display:!1}}})})();(()=>{transactions=$.map(transactions,function(n){return[[moment(n.date,"DD/MM/YYYY HH:mm").toDate(),n.commentaire,n.montant]]});var n=$(".table-consos-total-datatable").DataTable();n.clear();n.rows.add(transactions);n.draw()})();(()=>{$("#timepicker-conso").on("change.datetimepicker",function(){var u=$("#timepicker-conso").datetimepicker("viewDate"),n="years",r;$("#radio-conso-mois").is(":checked")?n="months":$("#radio-conso-soiree").is(":checked")&&(n="days",u.set("hour",15));const f=$.grep(transactions,function(t){return u.isBefore(t[0])&&moment(u).add(1,n).isAfter(t[0])}),e=$(".table-consos-total-datatable").DataTable();e.clear();e.rows.add(f);e.draw();r="month";n==="months"?r="day":n==="days"&&(r="hour");t(f,r);i(f)});$("input:radio").change(r);r()})()});